NAT (Network adress translation) - это механизм преобразования IP-адреса транзитных пакетов. Обычно применяется с целью экономии адресного пространства.

### Расположение и работа NAT-блока
![[nat_scheme.png]]
>[!note]
>На схеме NAT-блок распложен отдельно от маршрутизатора, но они могут быть объединены в одно устройство.

Зарезервированные диапазоны IP-адресов для NAT (private addresses):

первый адрес|последний адрес|длина префикса|количество
-|-|-|-
10.0.0.0|10.255.255.255|8|16 777 216
172.16.0.0| 172.31.255.255|12|1 048 576
192.168.0.0|192.168.255.255|16|65 536

Работает трансляция следующим образом.
- NAT-блок имеет настоящий IP-адрес, видимый из глобальной сети ( на схеме - 198.60.42.12)
- Внутри локальной сети все адреса соответствуют одному из трех зарезервированных диапазонов
- Если хост из локально сети с IP 10.0.0.1 (порт для ответа - 5544), отправляет запрос в интернет, то NAT подменяет в IP-пакете адрес с 10.0.0.1 на 198.60.42.12, а еще порт с 5544 на какой-то новый порт из неиспользованных, например 3344. Записывает в таблицу примерно следующее: 3344 связан с 10.0.0.1:5544.
- Когда на запрос придет ответ, он придет на 198.60.42.12:3344
- NAT-блок произведет обратные преобразования в пакете и отправит ответ на 10.0.0.1:5544.

>[!note]
>NAT не только занимается подменой IP-адресов, но еще и залазит в заголовки TCP и UDP пакетов. Это полностью нарушает всю идею разделения на уровни.

>[!note]
>При подмене IP-адресов и портов NAT вынужден пересчитывать и перезаписывать контрольные суммы.

>[!note]
>Адреса из зарезервированных диапазонов могут быть только внутри локальных сетей с NAT. 
>Допустим, что какой-то хост имеет IP из зарезервированного диапазона вне локальной сети с NAT. Если мы попробуем отправить запрос такому хосту из NAT, то мы не сможем отличить его от другого хоста с таким же IP в локальной сети.

>[!note]
>В такой системе запросы можно отправлять только изнутри локальной сети, но снаружи нельзя связаться с хостом внутри сети.
