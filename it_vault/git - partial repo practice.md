___
Частичным репозиторий - локальный репозиторий, которые содержит только часть файлов из оригинального репозитория; только те файлы, которые действительно требуются его владельцу.

В данной статье собраны основные методы работы с частичным репозиторием. Некоторые из этих методов были разобраны в предыдущих статьях, а некоторые представлены впервые.

Есть несколько способов управления размером репозитория:
- скачивать не все ветки
- не скачивать тэги
- субмодули
- скачивать историю не на всю глубину
- скачивать не все поддиректории

Далее рассмотрены практические аспекты каждого из этих методов.
___
### 1.  Ветки

Управление ветками уже рассматривалось здесь:
- [[git - remote recomendations]] -> 2.  Особенности клонирования.

Краткие выводы:
- нужно клонировать репозиторий с опцией `--single-branch`. Тогда при клонировании будет выкачена только основная ветка:
```bash
git clone --single-branch <repository> <directory>
```

Затем все остальные ветки с которыми предстоит работать нужно прописать вручную в файле `.git/config`:
```
[remote "origin"]
	url = git@github.com:<repo>.git
	fetch = +refs/heads/master:refs/remotes/origin/main
	fetch = +refs/heads/topic_1:refs/remotes/origin/topic_1
	fetch = +refs/heads/topic_2:refs/remotes/origin/topic_2
```
В результате для веток `topic_1` и `topic_2` будут созданы remote-tracking ветки. Чтобы создать tracking ветки следует выполнить команды:
```
git branch --track topic_1 origin/topic_1
git branch --track topic_2 origin/topic_2
```

Теперь будут скачиваться только заданные ветки.
>[!note]
>Если не нужно скачивать основную ветку, то можно воспользоваться опцией `--branch` и сразу скачать только нужную ветку.

___
### 2. Тэги

Обычно скачиваются только тэги, которые указывают на скачиваемые коммиты и другие объектам. Обычно этого достаточно, но есть и другие методы регулирования:
- [[git - tagging practice]]
___
### 3. Субмодули

Управление субмодулями рассматривается здесь:
- [[git - submodule basics]]
Краткий вывод: чтобы скачивать только нужные субмодули следует:
- склонировать репозиторий БЕЗ `--recurse-submodules`
- проинициализировать субмодули `git submodule init`
- деактивировать все ненужные сумодули в `.git/config`
___
### 4. Shallow history

Можно скачивать не всю историю, а только некоторое количество последних коммитов. Подобная практика описана в следующей статье:
- [[git - shallow history]]

>[!note]
>Использование shallow history в проектах с короткой историей не приводит к какому-то выигрышу, а может даже наоборот.

___
### 5. Sparse checkout

Для описания механизма sparse-checkout есть отдельная статья:
- [[git - sparse-checkout]]

___
### 6. Рекомендации при клонировании

Если репозиторий небольшой, то обычно проще выкачать его весь. В этом случае лучше использовать следующую команду:
```bash
git clone --recurse-submodules <repo>
```
Будут выкачены:
- все ветки
- все субмодули
- история на всю глубину

Если же нужно дополнительно настраивать репозиторий, то лучше клонировать репозиторий следующей командой:
```bash
git clone --no-checkout --single-branch --depth=0 <repo>
```
И уже потом настраивать ветки, субмодули (если есть) и так далее.
