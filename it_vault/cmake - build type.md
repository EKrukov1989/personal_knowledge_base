___
Зачастую пользователю нужно собирать различные варианты программы из одного исходного кода. Наиболее важный пример: релизная и дебажные конфигурации.

Cmake имеет несколько типов билда, определенных по умолчанию:

тип|описание
-|-
Debug|без оптимизаций и полной дебажной информацией
Release|полная оптимизация и без дебажной информации 
RelWithDebInfo|оптимизация и немного дебажной информации
MinRizeRel|оптимизация по размеру и без дебажной информации

Обычно этого должно хватить, однако у пользователя есть возможность создавать собственные типы билда.

Есть два типа генераторов проектных файлов:
- single project generators
- multiple project generators

Работать с каждым из этих типов приходится по-разному.
___
### 1. Single project generators

Наиболее интересный пример такого рода генераторов - `makefiles`.

Single-генераторы могут генерировать только один тип билда на директорию, поэтому тип билда нужно указывать это этапа конфигурирования и генерации:
```
cmake -G Ninja -DCMAKE_BUILD_TYPE:STRING=Debug ../source
cmake --build .
```
- таким образом мы передаем в команду cmake значение кэш-переменной `CMAKE_BUILD_TYPE`

Затем этот билд можно собрать только только с указанным типом билда. Если нужно изменить типа билда, то нужно очистить директорию и заново указывать кеш-переменную.

Но есть лучший вариант, который обычно используется: иметь несколько директорий билда, под одной для каждого типа.

>[!note]
>Если `CMAKE_BUILD_TYPE` не установлена, то будет "пустой" тип билда. Это особый тип билда, для которого cmake предусмотрел собственный набор флагов по умолчанию, отличный от `DEBUG` или `RELEASE`.

___
### 2. Multi project generators

Наиболее интересный пример такого рода генераторов - `msbuild`.

Чтобы собрать проект с нужным типом билда нужно указать тип билда не во время конфигурирования, а во время билда:
```
cmake -G Xcode ../source
cmake --build . --config Debug
```

Multi-генераторы хранят билд каждого типа в отдельной директории, причему basename этой директории будет таким же как тип билда.

___
### 3. Влияние типа билда на процесс сборки

Существует несколько способов, как тип билда может повлиять на процесс сборки.

1. Переменная `CMAKE_BUILD_TYPE`

Переменная `CMAKE_BUILD_TYPE` хранит тип билда и ее можно использовать в обычных условных выражениях. Однако это работает только для single-генераторов, поэтому такой вариант не рекомендуется.

>[!warning] Multi-генераторы игнорируют кэш-переменную `CMAKE_BUILD_TYPE`!

2. Генераторные выражения `$<CONFIG>` и `$<CONFIG:...>`

Выражение `$<CONFIG>` в процессе сборки (именно когда выполняется команда `cmake --build`) преобразуется к имени типа билда.

Выражение `$<CONFIG:..>` позволяет реализовать условную логику. Например:
- `$<IF:$<CONFIG:Debug>,Alice,Bob>`

3. Различные переменные

В cmake в процессе компилирования и линковки используются следующие переменные:
- `CMAKE_<LANG>_FLAGS_<CONFIG>`
- `CMAKE_<TARGETTYPE>_LINKER_FLAGS_<CONFIG>`

Содержимое этих переменных будет добавлено к `CMAKE_<LANG>_FLAGS` и `CMAKE_<TARGETTYPE>_LINKER_FLAGS` соответственно.

Содержимое этих переменных можно изменять, но cmake содержит вполне разумные значения по умолчанию:
- `CMAKE_CXX_FLAGS:`
- `CMAKE_CXX_FLAGS_DEBUG: -g`
- `CMAKE_CXX_FLAGS_RELEASE: -O3 -DNDEBUG`

Так же есть переменная `<CONFIG>_POSTFIX`.
Если присвоить ей значение, то для каждой созданной библиотеки будет добавлен указанный постфикс.
___
### 4. Рекомендации

Multi-генераторы игнорируют кэш-переменную `CMAKE_BUILD_TYPE`, поэтому перед тем как использовать эту переменную следует убедится, что используется single-генератор. Для этих целей служит специальное глобальное свойство:
- `GENERATOR_IS_MULTI_CONFIG` 

Лучше вместо использования `CMAKE_BUILD_TYPE` использовать генераторные выражения `$<CONFIG>` и `$<CONFIG:...>`.

Для multi-генераторов все возможные типы билда должны быть перечислены в переменной `CMAKE_CONFIGURATION_TYPES` и известны на этапе конфигурирования и генерации.
