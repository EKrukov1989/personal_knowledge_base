В linux каждый файл и каталог обладает набором прав доступа (mode). Каждый файл имеет владельца и группу. Всю эту информацию о файле можно получить, если ввести команду `ls -l` в директории файла. Вывод будет примерно примерно такой:
```
-rwxr-xr-x 1 gene admins  4453821 Oct 31  2017 Stallman - GCC.pdf"
    |        |    |
    V        V    V
    mode     user group
```

Здесь мы видим mode в символьном виде, хотя есть еще и числовая форма. Я считаю символьную форму более удобной, поэтому здесь буду рассматривать только символьную. Однако числовая тоже иногда нужна, поэтому пару слов про числовую форму.

Каждая набор прав имеет три флага, следовательно может быть выражен с помощью трех бит или одного октета.
```
--- 000 0
--x 001 1
-w- 010 2
-wx 011 3
r-- 100 4 
r-x 101 5
rw- 110 6
rwx 111 7
```

Следовательно все три набора прав могут быть выражены в виде трех октетов.

### 1. Обычные права для файлов

Обычные права для файла следующие:

mode|name|description
-|-|-
r|read|чтение файла (и копирование)
w|write|только редактирование файла
x|execute|исполнение

>[!note]
>Права `w` и `x` не имеют смысла и ничего не дают если нет прав `r`.

Набор прав в символьной форме представлен в виде последовательности из 10 символов (например `drwxrw-r--`). Правила записи следующие:
```
№   1    2 3 4   5 6 7   8 9 10
  { d } {r w x} {r w x} {r w x}
	     user    group   others
	   
Каждый из 10 символов может быть '-' либо тем символом, что приведен выше.
```

- Для директории первый символ -> `d`, для файла -> `-`.
- Первый набор флагов (2->4) - это права для владельца файла. То есть для пользователя, который является владельцем файла права доступа будут определяться этим набором флагов.
- Второй набор флагов (5->7) - это права для группы. То есть для пользователей, которые входят в группу этого файла, права доступа будут определяться этим набором флагов.
- Третий набор флагов (8->10) - это права для всех остальных.

### 2. Обычные права для директории

Обычные права для директории следующие

mode|name|description
-|-|-
r|read|только чтение имен файлов и больше ничего
w|write|создание, переименование, удаление*
x|execute|поиск, доступ к метаинформации файлов

На практике это значит следующее: если нет прав на r и x, то директорию нельзя даже открыть. Соответственно может быть только три значимых режима для директории:

набор|результат
-|-
`---`, `-w-`, `r--`, `--x` и т.д. | директорию даже нельзя открыть
`r-x`|чтение списка файлов и директорий внутри, чтение метаинформации файлов и даже изменение прав
`rwx`| все предыдущее + создание, переименование и удаление файлов

>[!note]
>Важно обратить внимание на то, то возможность удаления файла определяется не правами на файл, а правами на каталог!

>[!note]
>Если у вас нет прав `w` на каталог и в каталоге есть файлы, то такой каталог нельзя удалить. Так как чтобы удалить каталог - нужно сначала, удалить файлы.

### 3. Special execute

Помимо `x`, есть еще `X`(capital). Но это в сущности не право доступа, а скорее фича команды chmod ([[command - chmod]]).

### 4. Специальные права

Помимо обычных прав `rwx`, есть еще несколько специальных прав, которые встречаются реже:

##### 3.1 Setuid (SUID)

setuid <-> set user identity
В Unix-подобных операционных системах приложение запускается с правами пользователя, вызвавшего указанное приложение.

>[!note]
>Например, если пользователь без прав суперпользователя запустит скрипт, который будет делать что-то, что требует таких прав - он получит ошибку.

Если установлен бит SUID, то при выполнении программа будет выполняться с правами не пользователя, который запустил программу, а с правами владельца файла. 

>[!note]
>Бит SUID для каталогов, как правило, игнорируется.

Записывается SUID на место user-x следующим образом:
```
-rwsr-xr--  -> это означaет: -rwxr-xr-- с установленным SUID
-rwSr-xr-x  -> это означaет: -rw-r-xr-- с установленным SUID
```

##### 3.2 Setgid (SGID)
setgid <-> set group identity
То же самое, но файл будет запускаться не с правами пользователя, а с правами группы. Записывается таким же образом как и SUID, но на место group-x.

>[!note]
>SGID имеет особое значение для каталога.
>По умолчанию, когда создаются новые файлы и каталоги, то они получают ID группы пользователя, который их создает. Если установлен бит SGID, то они получат ID группы каталога.

##### 3.3 Sticky bit

>[!note]
>Если на каталоге стоит возможность записи (w), то файл внутри этого каталога можно будет удалить, даже если права на запись для него не установлено.

Sticky bit запрещает такое поведение. После установки этого флага можно будет удалить файл только если есть права на запись именно для этого файла.

Записывается sticky bit на место others-x следующим образом:
```
-rwxr-xr-t  -> это означaет: -rwxr-xr-x с установленным sticky bit
-rwxr-xr-T  -> это означaет: -rwxr-xr-- с установленным sticky bit
```


### 4. Правило защиты файлов от редактирования

Допустим у нас есть файл `config`, который находиться по следующему пути:
`/alice/bob/caren/config` и мы хотим защитить этот файл от редактирования. Правило защиты от редактирования завучит так:

>[!tip]
>Чтобы файл нельзя было отредактировать:
>		а) файл должен быть защищен от записи,
>		б) все его родительские каталоги защищены от записи.

Предположим, что это правило нарушено и режимы доступа следующие:
```
drwxr-xr-x  /alice
drwxr-xrw-  /alice/bob
drwxr-xr-x  /alice/bob/caren
drwxr--r--  /alice/bob/caren/config
```

Никто, кроме владельца файла не имеет прав записи для файла `config`, однако все имеют права записи для `/alice/bob`.

Тогда кто угодно может переименовать директорию `/alice/bob` в `/alice/bob2`, а затем создать новую с другим поддельным конфигом.



