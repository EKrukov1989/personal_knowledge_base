___
`sparse-checkout` - механизм, который позволяет работать с репозиторием, в котором отсутствует часть файлов.

Команда `git sparse-checkout` позволяет управлять этим механизмом.
___
### 1. Описание механизма

Файл `.git/info/sparse-checkout` содержит набор паттернов, которые определяют набор файлов и директорий которые нужны пользователю в локальном репозитории.

Это файл имеет такой же синтаксис как .gitignore-файл ([[git - gitignore]]) за тем исключением, что gitignore описывает исключаемые файлы, а sparse-checkout - включаемые.

>[!note]
>Sparse-checkout на субмодули не влияет, они контролируются отдельно.

Существует два режима работы sparse-checkout:
- cone
- non-cone

В non-cone режиме паттерны применяются к любым файлам, а в cone режиме - только к директориям. В non-cone режиме git может работать медленно, поэтому рекомендуется использовать cone режим.

Установить режим можно с помощью переменной:
- `core.sparseCheckoutCone=(true|false)` (cone режим установлен по умолчанию)
___
### 2. Синтаксис и правила cone режима

Файл `.git/info/sparse-checkout` содержит набор паттернов, каждый паттерн должен находится на отдельной строке.

Паттерны в cone режиме могут быть только двух видов:

1. Включающие:
 
 Пример: `/A/B/`
 Данные паттерн включает:
 - все файлы в `/`, но без поддиректорий
 - все файлы в `/A`, но без поддиректорий
 - все файлы и поддиректории в `/A/B/` со всем содержимым

2. Исключающие

Пример: `!/A/B/*/`
Данные паттерн исключает:
- директорию `/A/B/`
- все содержимое поддиректорий, которые находятся в `/A/B/`
Вот пример файлов, которые исключит этот паттерн:
```
/A/B/C
/A/B/D/  (будет исключен, так как директория)
/A/B/E/  (будет исключен)
/A/B/D/F (будет исключен)
/A/B/E/G (будет исключен)
```

Порядок паттернов важен, каждый следующий паттерн может переопределить предыдущий.
___
### 3. Команда sparse-checkout

##### Синтаксис:

`git sparse-checkout (list | set | add | reapply | disable) [<options>]`
##### Субкоманды:

`list`
- вывести содержимое `.git/info/sparse-checkout` в упрощенном виде

`set <pattern>...` 
- включить sparse-checkout
- составить файл на основе переданных паттернов
- привести рабочую директорию в соответствие

`add <pattern>`
- добавить еще один паттерн в список

`reapply`
- применить все паттерны

`disable`
- отключить sparse-checkout
- вернуть рабочую директорию в нормальное состояние
___
### 4. Рекомендации

Рекомендуется использовать по возможности только cone режим.
##### 4.1. Клонирование 

1. При клонировании указываем опцию `--sparse`:
```bash
git clone --sparse <repo>
```
2. Постепенно добавляем те директории, которые нужны для работы:
```
git sparse-checkout add abc
git sparse-checkout add def/ghi
```
Или можно вручную отредактировать файл `.git/info/sparse-checkout`.
##### 4.2. Если репозиторий уже склонирован

1. Включаем sparse-checkout:
```bash
git sparse-checkout set
```
2. Далее добавляем директории так же.