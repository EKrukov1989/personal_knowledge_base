___
Глоб (глоб-паттерн) - способ задания семейство имен файлов с помощью wildcard-символов. 

>[!note]
>Глоббинг бывает разный, но в этой статье будет рассматриваться только глоббинг в bash.
>Статья основана преимущественно на `man glob.7`.

Bash не поддерживает регулярных выражений, но поддерживает глоббинг.

___
### 1. Wildcard-символы

Паттерн представляет собой строку символов, которая состоит из:
- wildcard-символов (` ? * `)
- обычных символов
- списков символов, заключенных в квадратные скобки (но о них ниже)

Значение wildcard-символов:
`?` -> заменяет собой любой один символ
`*` -> заменяет собой любую строку, в том числе пустую

`\?\*\[\\`, `"?*["` -> можно использовать специальные символы буквально, если экранировать их обратным слешем или заключить в кавычки

___
### 2. Набор символов

Также паттерн может содержать наборы символов. Набор символов представляет собой последовательность символов, заключенных в квадратные скобки.

Правила при использовании списков:
- `[abc]` -> заменяет собой один из символов, которые перечислены в скобках
- `[!abc]` -> заменяет собой один символ среди тех, что не перечислены в скобках
- `[^abc]` -> вместо `!` может использоваться `^`, но это нестандарт
- `[][a]` -> внутри квадратных скобок должен быть хотя бы один символ, такая конструкция воспринимается как набор, состоящий из символов `][a`.
- `[?*[\]` ->внутри квадратных скобок все специальные символы понимаются буквально
- `[]ab]` -> можно даже использовать символ `]` внутри квадратных скобок, если поставить его первым в последовательности
 
___
### 3. Диапазоны

Два символа внутри квадратных скобок, разделенных знаком `'-'` обозначают диапазон. Диапазон это всего лишь краткая форма записи набор символов.
Т.е. `[a-f]` это ровно то же самое, что `[abcdef]`

Внутри квадратных скобок может быть несколько диапазонов, например:
`[a-dA-D]` это ровно то же самое, что `[abcdABCD]`

Таким образом `-` внутри квадратных скобок имеет особое значение. Чтобы применить его буквально, можно записать его в конце списка  -> `[ab-]`. 

___
### 4. Особенности для файловых путей

>[!note]
>В файловых путях любая непрерывная последовательсть прямых и обратных слешей воспринимается как один слеш.

Глоббинг применяется для каждого компонента пути отдельно, т.е. никакие wildcard-символы не могут заменить слэш. В квадратных скобках тоже не может присутствовать. Так сделано специально.

Еще одна особенность глоббинга - работа со скрытыми файлами. Если имя файла начинается с символа `'.'`, то этот символ не может быть заменен с помощью wildcard-символов, а должен быть указан специально. Примеры:

имя файла | паттерн | результат
-|-|-
`.abc`|`*c`|not match
`.abc`|`?bc`|not match
`.abc`|`[.-]abc`|syntactically incorrect
`.abc`|`.*c`|match
`.abc`|`.?c`|match
`.abc`|`.[abc]bc`|match

___
### 5. Опции shopt для глоббинга

Можно управлять опциями shopt с помощью команд:
```bash
shopt -s nullglob  # включить опцию nullglob
shopt -u nullglob  # выключить опцию
shopt -p  # посмотреть состояния всех опций
```
##### 5.1. nullglob

По умолчанию, если в процессе `pathname expansion` не удалось найти ни одного совпадения, то паттерн раскрывается сам в себя.
Если установить опцию `nullglob`, то в этом случае паттерн будет раскрываться в пустую строку, что зачастую более ожидаемо.
##### 5.2. failglob

Если опция failglob установлена и паттерн не нашел совпадений, то будет выведено сообщение об ошибке.
##### 5.3. dotglob

Обычный глоббинг не находит скрытые файлы, если опция failglob установлена, то например паттерн `*` сможет найти как обычные файлы и папки, так и скрытые.
##### 5.4. nocaseglob

Если эта опция установлена, то глоббинг становится нечувствительным к регистру.
##### 5.5. globstar

Если эта опция установлена, то можно использовать сочетание символов `**`.
Такое wildcard-сочетание способно заменять любую последовательность компонентов пути, в том числе пустую.

Например паттерн `**/tmp` найдет файлы tmp во всех подпапках.
Паттерн `**` найдет все файлы во всех поддерикториях.
Паттерн `abc/**/pqr.stu` подойдет для следующих путей:
```bash
abc/pqr.stu
abc/def/pqr.stu
abc/def/ghi/pqr.stu и так далее
```

Однако, wildcard-сочетание неспособно части компонентов.
Например паттерн `abc/d**i/pqr.stu` не подойедет к пути `abc/def/ghi/jkl/mno/pqr.stu`, для этого нужен паттерн  `abc/d*/**/*i/pqr.stu`.

>[!tip] Первое правило при использованию globstar:
>>Globstar в паттерне должен быть ограничен слэшами с двух сторон -> `/**/`, кроме тех случаев, когда он расположен в самом начале или в самом конце
##### 5.6. extglob

Если эта опция установлена, то можно использовать еще несколько паттернов в глоббинге:
- `@(pattern-list)` -> подходит к строкам, которые соответствуют одному из паттернов в  списке
- `?(pattern-list)` -> то же, что и `@(pattern-list)`, но также к пустой строке
- `+(pattern-list)` -> подходит к строкам, которые состоят из одной или более подстрок, каждая из которых подходит к одному из паттернов в  списке
- `*(pattern-list)`-> то же, что и `+(pattern-list)`, но также к пустой строке
- `!(pattern-list)`-> подходит ко всему, кроме строк, которые соответствуют одному из паттернов в списке. В отличие от остальных паттернов он всегда применяется ко всему имени

Под `pattern-list` понимается последовательность паттернов разделенная символами: `|`. Например `john|paul`.

Примеры использования паттернов:
```text
pattern:   @(john|paul)2
match:     john2 paul2 (это полный список подходящих строк)

pattern:   ?(john|paul)2
match:     john2 paul2 2 (это полный список подходящих строк)

pattern:   +(john|paul)2
match:     john2 paul2 johnpaul2 pauljon2 johnjohnpaul2 ...
not-match: 2 john2paul2...

pattern:   *(john|paul)2
match:     2 john2 paul2 johnpaul2 pauljon2 johnjohnpaul2 ...
not-match: john2paul2...

pattern:   !(john|paul)2
match:     2 john2paul2 johnpaul2 ...
not-match: john2 paul2 (это полный список неподходящих строк)
```
