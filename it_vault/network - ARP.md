ARP (Address Resolution Protocol) — протокол разрешения адресов.

Все пакеты в интернете отправляются на какой-то IP-адрес. Но внутри сети нужно устройства обмениваются кадрами, следовательно для того, чтобы отправить пакет, нужно сначала знать MAC-адрес устройства (хоста или маршрутизатора), на который нужно передать кадр.

Для этого нужен протокол ARP.

Допустим у нас есть сеть, в которой есть несколько хостов и маршрутизатор, который соединяет ее с глобальной сетью. И нам нужно отправить запрос с хоста на определенный IP-адрес.

У сетевой карты должна быть следующая информация:

parameter|value
-|-
default gateway|192.168.212.1
netmask|255.255.255.0

Прежде всего сетевая карта смотрит на адрес назначения и сравнивает его с маской подсети.

Если адрес назначения принадлежит данной подсети, например 192.168.212.4, то сетевая карта рассылает широковещательный ARP-запрос, с просьбой сообщить MAC-адрес хоста с определенным IP. Хост с таким IP должен ответить на этот вопрос и выслать свой MAC-адрес.

В противном случае пакет нужно отправлять на маршрутизатор, который называется default gateway - шлюз по умолчанию. Нам известен IP-адрес шлюза по умолчанию - 192.168.212.1, но неизвестен его MAC-адрес. Чтобы узнать MAC-адрес отправляется ARP-запрос на этот IP и после получаения ответа можно будет отправить пакет на маршрутизатор.

>[!note]
>По соглашению IP-адрес шлюза по умолчанию это наименьший адрес подсети. 

>[!note]
>Чтобы не посылать ARP-запрос для каждого пакета применяется ряд оптимизаций:
>	1. кэширование результатов ARP-запросов
>	2. ARP-запрос содержит физический адрес и IP-адрес отправителя, поэтому пока этот запрос путешествует по сети, все хосты добавят в свои таблицы эту пару адресов
>	3. при подключении каждый хост отправляет ARP-пакет на собственный IP, чтобы все хосты в сети могли запомнить его адрес.

