nmap (network mapper) - команда для скана портов и много чего еще. Данная утилита настолько обширна, что есть даже целая книга: https://nmap.org/book/

Синтаксис команды:
`nmap [scan_type(s)] [options] {target_specification}`

### 1. Target specification

Target - цель исследования. В качестве цели может выступать:
- IP-адрес `192.168.10.0`
- имя хоста `microsoft.com`
- подсеть -> `192.168.10.0/24`

>[!tip]
>Если в качестве цели выбрано имя хоста, то для получения IP-адреса будет использован DNS-сервер. Если с именем хоста связано нескольно IP-адресов, то будет просканирован только первый. Чтобы просканировать все адреса нужно использовать флаг `--resolve-all`.

### 2. Host discovery

##### 2.1 list scan `-sL`
При данном способе обнаружения никакие пакеты на хосты не посылаются. Производится только reverse DNS запрос, чтобы найти имена хостов. Также учитывается информация в файле `/etc/hosts`. Результат выводится в виде таблицы, например:
```
Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 19:08 MSK
...
Nmap scan report for nwtpc (192.168.213.200)
Nmap scan report for yandex.ru (77.88.55.60)
...
Nmap done: 100500 IP address (0 hosts up) scanned in 0.07 seconds
```
Здесь `nwtpc` - получено из `/etc/hosts`, а `yandex.ru` - из DNS запроса.

##### 2.2 ping scan `-sn`
В отличие от 'list scan' все хосты пингуются и выводится только список хостов подсети, которые отвечают (up).

##### 2.3 No ping `-Pn`
Обычно сканирование портов производится только для хостов, которые были успешно пропингованы. Если использовать опцию `-Pn`, то сканирование будет произведено для всех хостов (даже без попыток пинга).

### 3. Port scanning

Согласно nmap, порт может находится в одном из шести состояний:
- **open** 
	устанавливает соединения, принимает датаграммы и т.д.
- **closed**
	доступен, но никто не слушает этот порт
- **filtered**
	порт не возвращает никакой информации и следовательно закрыт файерволом
- **unfiltered**
	порт доступен, но непонятно открыт от или нет (только для ACK-скана)
- **open | filtered**
	это состояние характерно для сканов, в которых открыты порт не должен давать ответ. Непонятно либо порт открыт, либо просто ответ отфильтрован
- **closed | filtered**
	примерно то же, только с закрытым портом

##### 3.1 Port list `-PS`, `-PA`
Сканирование портов посредством отправки SYN и ACK сообщений соответственно.

Например, команда `nmap -PS 192.168.212.0/24` пропингует подсеть и для всех активных хостов - проведет сканирование портов. В результате для каждого активного хоста можно получить примерно следующую информацию:
```
Nmap scan report for 192.168.212.34
Host is up (0.0032s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

##### 3.2 Port list `-PU` (UDP ping)
При сканировании портов через TCP, зачастую firewall блокирует любые ответные сообщения. В результате хост может быть определен как неактивный (down). В данном варианте для сканирования портов используются UDP, и зачастую это позволяет найти больше хостов в сети.

##### 3.2 Port specification
По умолчанию, nmap сканирует 1000 самых популярных портов и иногда это нас совсем не устраивает. Флаг `-p` позволяет задать набор портов, которые следует просканировать. Например, команда `-p U:53,111,137,T:21-25,80,139,8080`, определяет набор UDP и TCP портов.

### 4. OS detection

С помощью флага `-O` можно определить операционные системы хостов в сети, тип устройства и некоторые другие детали. Например, `nmap -O 192.168.212.0/24` . К сожалению, данная команда не для всех хостов.
