___
Функция в bash - это составная команда, у которой есть имя.

Особенности функций в bash:
- Имя функция может быть использовано ровно так же, как имя любой другой команды.
- Функция выполняется в том же процессе, что и вызвавший ее скрипт.
- Все переменные скрипта доступны функции, без необходимости их экспортировать. 
- Функция может изменять переменные вызвавшего скрипта и изменения сохранятся после выхода из функции.
- Функция можно вызывать из других скриптов.

___
### 1. Синтаксис

Функцию в bash можно объявить тремя разными способами:
- `function name <compound command>`
- `function name() <compound command>`
- `name() <compound command>`  -> предпочтительный вариант

В качестве составной команды (compound command) могут выступать следующие конструкции:
- набор команд внутри скобок: `(..)`, `{..}`, `((..))`, `[[..]]`
- конструкции `case`, `for`, `select`, `while`, `until`

Примеры:
```bash
# для круглых скобок любое положение валидно:
foo() ( echo $1; echo $2 )

# для фигурных скобок закрывающая скобка должна быть на отдельной строке:
foo()
{
	echo $1  # отступ только для красоты
}

foo() { echo $1
}

# для двойных круглых скобок так же любое положение валидно,
# но важно помнить, что такая функция может вернуть только exit code:
foo() (( $1 + $2  ))

# то же действительно для двойных квадратных скобок:
foo() [[ -z $1 ]]

# для case, for, select, while, until никакие скобки не нужны:
foo()
for elt in $@
do
	echo $elt
done
```

>[!warning]
>Если составная команда заключена в круглые скобки, то она будет исполнена в дочерней оболочке. Соответственно, ей не будут доступны локальные переменные вызвавшего скрипта и она не сможет менять никаких переменных в вызвавшем скрипте.

>[!tip]
>Описание синтаксиса функции можно разместить в комментарии следующим образом: `read()  # USAGE: read [file]`

___
### 2. Локальные  переменные

Функция выполняется в том же процессе, что и вызвавший скрипт, поэтому если объявить переменную внутри фунции, то она будет видима в скрипте. Чтобы объявить переменную, область видимости которой будет ограничена функцией, нужно использовать ключевое слово `local`:
```bash
local locvar
local -A loc_hmap
```

___
### 3. `return` и `exit`

Можно прервать выполнение функции с помощью команды `return N`, где `N` - код выход из функции. Код выхода из функцию должен быть в интервале `[0..255]`.

При использовании команды `return N` выполнение функции прерывается, но вызвавший ее скрипт продолжает выполняться. Если же внутри функции выполнить команду `exit`, то это приведет к завершению выполнения скрипта.

___
### 4. Redirection

Можно перенаправить потоки функции с помощью следующего синтаксиса:
```bash
foo()
{
    echo something
} > ${1:-/dev/fd/1}
```

Перенаправление потоков происходит во время выполнения функции, поэтому можно использовать разного рода раскрытия.

Кстати, всегда можно перенаправить потоки при вызове функции:
`foo > ${1:-/dev/fd/1}`

___
### 5. Обращение к функции из другого скрипта

Допустим у нас есть некоторый набор функций, к которым мы хотим обращатьс из других скриптов:
```bash
foo() ( echo "foo" )

bar() ( echo "bar" )

baz() ( echo "baz" )
```

Прежде всего следует положить эти функции в отдельный скрипт, в котором будут только функции и никаких других команд. Пусть это будет файл `~/Desktop/funcs.scr`.

Далее если мы хотим использовать функцию `bar` в своем скрипте, то нужно делать это следующим образом:
```bash
source ~/Desktop/funcs.scr
bar
```

Если же мы не хотим использовать абсолютный путь, то можем положить скрипт в одну из директорий, которые перечислены в `$PATH` и обращаться к нему по имени.