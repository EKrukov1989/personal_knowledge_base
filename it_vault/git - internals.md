___
Основано на Pro GIT 2.1.404. Глава - Git Internals
>[!warning] В этой статье законспектировано все, вплоть до подглавы Refspec

Краткое изложение статьи:
- объект это блоб, дерево, коммит или аннотированный тэг
- блоб это просто блоб
- дерево это список указателей на блобы и деревья
- коммит указывает на дерево
- ссылка указывает на коммит
- бранч это ссылка
- символическая ссылка - ссылка на другую ссылку
- легкий тэг это ссылка, но необязательно на коммит
- аннотированный тэг это ссылка на специальный объект тэга

___
### 1. Объекты

Вся история проекта хранится в репозитории в папке `.git/objects/` в виде объектов. Объекты могут быть разных типов, но способ хранения одинаков для всех типов.

Каждый объект соответствует одному сохраненному файлу. Рассмотрим процесс сохранения:
- нужно сохранить файл `filename.txt`
- контент этого файла - `abcdefgh`.
- SHA-1 хэш этого контента: `0e5c23f7f91ea69e374da16de6e8740140fd4ed1`
- сохраним файл с помощью команды:
```bash
cat filename.txt | git hash-object -w --stdin
```
- в результате выполнения этой команды будет создан файл по адресу:`.git/objects/0e/5c23f7f91ea69e374da16de6e8740140fd4ed1` в котором будет хранится контент `filename.txt`, только в сжатом виде
- имя сохраненного файл таким образом никак не сохраняется

Таким образом может быть сохранен любой файл, но обычно объекты бывают следующих типов:
- блоб
- дерево
- коммит
- аннотированный тэг

С помощью команд `git cat-file` можно получить информацию о любом объекте:
- `git cat-file -p <has-code>` -> вывести содержимое объекта
- `git cat-file -t <has-code>` -> вывести тип объекта
- `git cat-file -s <has-code>` -> посмотреть размер объекта
##### 1.1.  Блоб

Блоб это просто файл проекта. Например, файл исходного кода.
##### 1.2.  Дерево

Дерево - это объект, хранящий информацию о директории. В директории могут храниться файлы и поддиректории, соответственно дерево хранит ссылки на блобы и деревья, а также сопутствующую информацию:

Содержимое объекта-дерева может выглядеть примерно вот так:
```
100644 blob a906cb2a4a904a152e80877d4088654daad0c859 README
100644 blob 8f94139338f9404f26296befa88755fc2598c289 Rakefile
040000 tree 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0 lib
```
В данной директории находились два файла и одно поддиректория, соответственно объект дерево хранит ссылки на два блоба и на одно дерево.
Также здесь хранится информация о типах объектов, имена и режимы доступа.

ПРИМЕЧАНИЕ:
Информацию об имени файла можно получить только из объекта дерева, поэтому в репозитории обязательно должно храниться также дерево, соответствующее всей рабочей директории. Это дерево имеет особое значение.

Посмотреть объект дерева можно с помощью команды:
```bash
git cat-file -p master^{tree}
```
##### 1.3.  Коммит

История проекта хранится в виде цепочки коммитов.
Коммиты это тоже объекты, которые содержать следующую информацию:
- хэш-код дерева рабочей директории (если где-либо в проекте что-то было изменено, то хэш-код рабочей директории тоже должен измениться)
- информацию об авторе и коммитере
- сообщение, прикрепленное к коммиту

Например:
```
tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579
author Scott Chacon <schacon@gmail.com> 1243040974 -0700
committer Scott Chacon <schacon@gmail.com> 1243040974 -0700

First commit
```

___
### 2. Ссылки

Пользователю взаимодействует не с блобами и деревьями, а с коммитами. Коммиты связаны между собой в цепочки, поэтому пользователю необязательно помнить хэши всех коммитов, но нужно помнить хотя бы хэш головного коммита.
Для это цели придуманы ссылки.

Ссылка это просто файл в `refs/`, который хранит хэш-код коммита. Пользователь может через имя этой ссылки обратится к коммиту, на который она ссылается.

Например:
Ссылка `refs/heads/master` хранит следующее:
```
1a410efbd13591db07496601ebc7a059dd55cfe9
```
##### 2.1. Символическая ссылка

Символическая ссылка ссылается не на коммит, а на другую ссылку.

Например:
Ссылка `.git/HEAD` хранит следующее:
```
refs/heads/master
```
##### 2.2. Голова

Обычно файл  `.git/HEAD` хранит символическую ссылку, но может хранить и хэш на коммит. В таком случае репозиторий находится в состоянии `detached HEAD`.

___
##### 2.3. Легкие тэги

Легкий тэг это в сущности просто ссылка, но в отличии от ссылки он може указывать на любой объект.

Например:
Файл тэга `.git/refs/tags/tagname` хранит в себе хэш-код коммита:
```
9585191f37f7b0fb9444f35a9bf50de191beadc2
```
##### 2.4. Аннотированные тэги

Аннотированный тэг тоже может указывать на любой объект, но это уже не просто ссылка. При создании аннотированного тэга создается еще один объект, который хранит дополнительную информацию.
Например:

Создадим аннотированный тэг для объектак с `<hash_code>` с помощью команды:
```bash
git tag -a <tag_name> <hash_code> -m <tag_message>
```
В результате будет создано два файла:
1. Тэг-объект, с примерно следующим содержимым:
```
object <hash_code>
type <object_type>
tag <tag_name>
tagger <tagger_name>

<tag_message>
```
2. Файл тэга `.git/refs/tags/<tag_name>`, который хранит хэш-код тэг-объекта.
##### 2.5. Ремоут ссылки

Ремоут ссылка это ссылка на бранчу в удаленном репозитории.
Она отличается от обычной ссылки тем, что на нее нельзя установить HEAD.
Ремоут ссылки хранятся в `.git/refs/remotes/`.
