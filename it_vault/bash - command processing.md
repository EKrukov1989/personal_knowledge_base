___
Процесс обработки команд в баш сложнее, чем кажется. Рассмотрим самые простой вариант команды:

```bash
hello.exe gene
```

Допустим, что `hello.exe` это исполняемый файл. Тогда баш:
- запустит этот исполняемый файл
- передаст ему два аргумента `./hello.exe` и `gene`

Действительно в простейшем примере все выглядит элементарно. Однако на самом деле перед тем, как вызвать команду и передать ей список аргументов баш проделывает большую работу, которая будет поэтапно рассмотрена в этой статье.

Допустим баш прочитал некоторую последовательность символов из скрипта и теперь ее нужно обработать.

___
### 1. Pipeline parsing

Полученная строка может оказаться не просто командой, а целым пайплайном: `ls -la | grep *.exe > ouptut.txt`
Если это так, то баш разделает пайплайн на команды, соединяет вводы и выводы, а затем уже обрабатывает каждую команду.
Дальнейший процесс рассмотрен для одной команды.

___
### 2. Primary word splitting

Подробнее: [[bash - word splitting]]
На этом этапе полученная строка разделяется на слова. При этом в качестве разделителей используются только уайтспейсы.

На этом этапе еще нет разделения на команду и аргументы, пока есть только строка. Например:
```
a="echo abc"
$a def
вывод:
abc def
```

Все последующие операции производяться уже только над полученными словами.

___
### 3. Quoting notes

Все слово может быть заключено в кавычки, или некоторые его части.
Например: `aaa"B'BB\"BBB"ccccc'DDD"DD'eee\'ee`.
В данной строке есть две части, которые взяты в кавычки - последовательность символов B и D. Есть много кавычек, но только некоторые из них выступают в роли специальных символов.

Кавычки, которые выступают в роли специальных символов в конечном итоге будут изъяты из слов, но оказывают влияение на дальнейшую обработку слов.

В дальнейшем, баш воспринимает это слово следующим образом:
`aaa"B'BB\"BBB"ccccc'DDD"DD'eee\'ee`.
`xxxYYYYYYYYYYYxxxxxZZZZZZZZxxxxxxx`
И будет обрабатывать следующим образом:
- части `x` ,будет подвергнуты всем дальнейшим этапам
- часть `Y` будет подвергнута `variable expansion` и `command substitution`
- часть `Z` останется в неизменном виде

>[!note]
>Важно понимать, что этот процесс не рекурсивен.
>Роль специальных символов играют только те кавычки, которые присутствуют в изначальном слове. Если в слове окажуться какие-то еще кавычки в результаты раскрытий - они уже не будут играть роль специальных символов.

___
### 3. Brace expansion

Подробнее: [[bash - brace expansion]]
Если есть слово, подлежащие brace expansion, то оно может быть замещено на несколько других слов, 

Полученные слова затем участвуют в: variable expansion,
но не участвуют в word splitting
Пример:
```
var1=a
var2=b
echo $var{1,2}
вывод:
a b
```

___
### 4. Tilde expansion

Подробнее: [[bash - tilde expansion]]

___
### 5. Parameter and variable expansion

Подробнее: [[bash - parameter and variable expansion]]
Здесь нужно заметить, что variable expansion не рекурсивна. Если обратить внимание на следующий код, то может показаться, что переменные раскрываются рекурсивно:
```bash
a='abc'
b="_${a}_"
echo "$b"
вывод: _abc_
```
Т.е. `echo "$b"` раскрывается в echo `echo "_$a_"` и далее в `echo "_abc_"`.
Если же написать этот код в другом порядке, то станет очевидно, что это не так:
```bash
b="_${a}_"
a='abc'
echo "$b"
вывод: __
```
На самом деле, содержимое переменной b определяется в момент присваивания и в дальнейшем это просто строка.

___
### 6. Ariphmetic expansion

Подробнее: [[bash - ariphmetic expansion]]

___
### 7. Command substitution

Подробнее: [[bash - command substitution]]

___
### 8. Secondary word splitting

Подробнее: [[bash - word splitting]]
Вторичное разделение имеет несколько особенностей:
- вторичному разделению подвергаются только те слова, которые подверглись развертыванию
- во вторичном разделении используются символы из IFS

___
### 9. Pathname expansion

Подробнее: [[bash - pathname expansion]]

___
### 10. Process substitution

Подробнее: [[bash - process substitution]]

>[!note] personal note
>Процесс обработки команд в баш не рекурсивен, а линеен. Некоторые аспекты, такие как variable expansion после brace expansion создают иллюзию рекурсивности, но это не так. Для рекурсии в баш есть другие механизмы.


 
