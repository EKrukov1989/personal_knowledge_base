___
Cmake -  это кроссплатформенный инструмент для сборки программ. Помимо сборки cmake позволяет также запускать процесс тестирования и упаковки собранных программ.
___
### 1. Описание процесса

Весь процесс состоит из следующих этапов:

![[cmake_start_to_end_process.png]]

На входе в этот конвейер мы имеем:
- файлы исходного кода: `.h`, `.cpp` и т.д.
- файлы `CMakeLists.txt` - описание проекта с помощью специального предметно-ориентированного языка (независимо от платформы)
#### Этап 1. Configuring
Проводятся все необходимые проверки и выстраивается внутреннее предоставление о проекте. На этом этапе никаких файлов не генерируется.
#### Этап 2. Generation
Генерируются проектные файлы для выбранной билд-системы.
#### Этап 3. Build
Выполняется сборка всех целей на основе сгенерированных проектных файлов. Фактически cmake просто запускает выбранную билд-систему.
#### Этап 4. Test
Запускаются тестовые приложения, возможно собранные только что на предыдущем этапе.
#### Этап 5. Package
Запускается указанная программа для упаковки програмы.

___
### 2. In-source & out-of-source buillds

Производимые бинарные файлы можно размешать непосредственно среди исходных файлов или же их можно вынести в отдельную директорию.

Первый вариант называется **_in-source build**_ и он обладает следующими недостатками:
- сложно чистить производимые файлы
- сложно сделать несколько билдов
- производимые файлы могут затереть исходные

Такой вариант не рекомендуется. Всегда следует использовать **_out-of-source builld_**. В этом вариант исходные файлы и производимые файлы разделены примерно следующим образом:
```
workdir
	source
		CMakeLists.txt
		.cpp, .h ...
	build
		CMakeCache.txt
		.o, .a, .sh ...
```

___
### 3. Самые основные команды

В самом простом случае для сборки проекта нужно всего две команды:

**Генерация проектных файлов
```bash
cmake -G <generator> <source_dir>
```
- провести configuring и generation для исходных файлов, находящихся в `<source_dir>`. Непосредственно в `<source_dir>` так же должен находится файл `CMakeLists.txt`
- поместить сгенерированные проектные файлы в текущую директорию

Опция `-G <generator>` позволяет выбрать генератор проектных файлов. Генератор - это платформозависимая билд-система: make, msbuild и т.д. Если опция не указана, то будет использована переменная окружения `CMAKE_GENERATOR`. Если такая переменная не установлена, то генератор будет выбран в соответствии с платформой хоста.

**Сборка проекта
```bash
cmake --build <build_path> --config <configuration> --target <target> 
```
- собрать выбранные цели с помощью билд-системы, для которой на предыдущем этапе были сгенерированы проектные файлы
Доступные опции :
- `--build <build_path>` -> указать директорию, в которой находятся сгенерированные проектные файлы
`--config <configuration>` -> указать конфигурацию, например `debug`
`--target <target>` -> указать цель, которую следует собрать

___
### 4. Hello, World!

Пример сборки простейшего проекта с помощью cmake:
Структура файлов проекта:
```
build
	[CMakeCache.txt]
	[app]
	... другие файлы созданные cmake
src
	CMakeLists.txt
	main.cpp
```
CMakeLists.txt:
```cmake
cmake_minimum_required(VERSION 3.25)
project(helloworld VERSION 0.1 LANGUAGES CXX)
add_executable(app main.cpp)
```
main.cpp:
```cpp
#include <iostream>
int main() {
	std::cout << "Hello, World!" << std::endl;
	return 0;
}
```
Чтобы собрать проект следует выполнить следующие команды:
```bash
cd build
cmake ../src
cmake --build .
```
