___
Статья написана на основе `man ssh_config.5`.
ssh_config - конфигурационный файл для клиента ssh. Далее "конфиг".

___

### 1. Сбор настроек

При каждом вызове ssh собирает свои настройки из нескольких источников. Порядок сбора настроек следующий:
1. Аргументы командной строки, которые указываются с помощью флага `-o`
2. Конфигурационной файл пользователя: `~/.ssh/config`
4. Конфигурационный файл системы: `/etc/ssh/ssh_config`.

Главное правило конфига звучит так:
>[!tip] Для каждого конфигурационного параметра будет выбрано значение, которое найдено первым.

>[!note]
>В Debian в начале файла `/etc/ssh/ssh_config` указана директива `Include /etc/ssh/ssh_config.d/*.conf`, но по умолчанию в этой директории никаких конфигурационных файлов нет.

>[!note]
>ssh клиент имеет опцию `-F configfile`, с помощью которой можно указать конкретный конфиг файл.

___
### 2. Структура конфигурационного файла

Конфигурационный файл определяет набор опций в зависимости от хоста и имеет следующую структуру:

```text
Host home
	RekeyLimit 1G 1h

Match user any
	SendEnv LANG LC_*

Host *
    UserKnownHostsFile ~/.ssh/known_hosts.d/%k
    HashKnownHosts yes
```

ssh будет читать файлы конфигов от начала и до конца и если имя хоста соответствует паттерну после ключевого слова `Host`, то все значения из этой подгруппы будут применены.

Для каждого параметра будет применено значение, которое найдено первым, поэтому ниболее общие паттерны следует добавлять в конец..

Синтаксис конфигурационных файлов:
- строка начинающаяся с `#` -> комментарий
- аргументы могут быть заключены в двойные кавычки

___
### 3. Паттерны и списки паттернов

Правила составления паттернов:
- паттерн не может содержать уайтспейс-символы
- паттерн может содержать обычные символы и вайлдкард-символы: `*` `?`
- значения вайлдкард-символов - обычное
Примеры паттернов: `*.example.com`, `*`, `home-pc`, `192.168.0.?`

Правила составления списков паттернов:
- список паттернов состоит из паттернов, разделенных запятыми без пробелов
- хост подходит к списку паттерно, если он подходит хотя бы одному из паттернов
- некоторые паттерны могут быть инвертированы, с помощью символа `!`
- паттерны в списке читаются слева направо
- если хост подходит к инвертированному паттерну, то он не подходит ко всему списку

Пример:
```
Host !host1,!host2,*
```
Можно выразить это паттерн с помощью псевдокода:
```
if host1
	return false
if host2
	return false
if *
	return true
return false
```

___
### 4. Ключевые слова

Нет смысла перечислять весь `man ssh_config`. Здесь только избранное.

`Port`
- можно указать порт к которому подключен ssh-сервер на удаленном хосте. Обычно, имеет смысл указывать для одного определенного хоста.

`PasswordAuthentication yes|no`
- использовать аутентификацию с помощью пароля
- по умолчанию - `yes`

`AddKeysToAgent yes|no|ask|confirm`
- добавлять ключи автоматически в ssh-agent
- `ask` - ssh будет спрашивать пароль перед тем как добавить ключ
- `confirm` - каждое использованию ключа должно быть подтверждено
- по умолчанию - `no`

`HashKnownHosts`
- хэшировать имена хостов и адресы в файле know hosts
- по умолчанию - no, но в ubuntu - yes

`IdentityFile`
- указать определенный публичный ключ, который следует использовать при подключении
- можно указать несколько ключей

`StrictHostKeyChecking yes|no|accept_new|ask`
- если этот флаг установлен, ssh автоматически не добавляет ключи в known_hosts и отказывается соединяться с хостами, которых нет в этом списке
- `accept_new` - ssh добавляет новые хосты, но сигнализирует если хост поменял ключ
- `ask` - спрашивать передм тем как добавлять в known_hosts
- по умолчанию - `ask`

`User`
- можно указать имя пользователя, под которым следует подключаться к этому хосту





